rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Colección de usuarios
    match /usuarios/{userId} {
      // Lectura para cualquier usuario autenticado
      allow read: if request.auth != null;

      // Escritura para cualquier usuario autenticado
      allow write: if request.auth != null;
    }

    // Colección de asesorías
    match /asesorias/{asesoriaId} {
      // Lectura: solo el usuario que creó la asesoría o el programador asignado
      allow read: if request.auth != null &&
                  (request.auth.uid == resource.data.usuarioId || request.auth.uid == resource.data.programadorId);

      // Creación: cualquier usuario autenticado puede crear su asesoría
      allow create: if request.auth != null;

      // Actualización: solo el programador asignado puede actualizar el estado o mensaje de respuesta
      allow update: if request.auth != null &&
                    request.auth.uid == resource.data.programadorId &&
                    request.resource.data.keys().hasOnly(['estado','mensajeRespuesta']) ;
    }
  }
}
