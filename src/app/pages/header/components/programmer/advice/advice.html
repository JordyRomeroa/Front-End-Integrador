<section class="w-full max-w-6xl mx-auto relative">

  <!-- Notificación Usuario -->
  @if (notificacionUsuario()) {
    <div class="fixed top-4 right-4 bg-green-500 text-white p-4 rounded shadow-lg animate-fadeInDown z-50">
      {{ notificacionUsuario() }}
    </div>
  }

  <!-- Notificación Admin -->
  @if (notificacionAdmin()) {
    <div class="fixed top-4 right-4 bg-blue-500 text-white p-4 rounded shadow-lg animate-fadeInDown z-50">
      {{ notificacionAdmin() }}
    </div>
  }



  <h2 class="text-xl font-bold mt-6 mb-3">Solicitudes Pendientes</h2>

  @if (pendientes().length > 0) {
    @for (asesoria of pendientes(); track asesoria.id) {

      <div class="card shadow-md p-4 mb-4 bg-white">

        <p><strong>Usuario:</strong> {{ asesoria.nombreUsuario }}</p>
        <p><strong>Teléfono:</strong> {{ asesoria.telefono || 'No registrado' }}</p>
        <p><strong>Comentario:</strong> {{ asesoria.mensaje }}</p>
        <p><strong>Fecha solicitada:</strong> {{ asesoria.fecha | date:'dd/MM/yyyy HH:mm' }}</p>
        <p><strong>Estado:</strong> {{ asesoria.estado }}</p>

        <div class="mt-3 space-x-2">
          <button class="btn btn-success" (click)="abrirModal(asesoria)">Responder</button>
        </div>
      </div>

    }
  } @else {
    <p class="text-gray-500">No tienes asesorías pendientes.</p>
  }




  <h2 class="text-xl font-bold mt-8 mb-3">Historial</h2>

  @if (historial().length > 0) {
    @for (asesoria of historial(); track asesoria.id) {

      <div class="card shadow-md p-4 mb-4 bg-gray-100 text-gray-700">

        <p><strong>Usuario:</strong> {{ asesoria.nombreUsuario }}</p>
        <p><strong>Teléfono:</strong> {{ asesoria.telefono || 'No registrado' }}</p>
        <p><strong>Comentario:</strong> {{ asesoria.mensaje }}</p>
        <p><strong>Fecha solicitada:</strong> {{ asesoria.fecha | date:'dd/MM/yyyy HH:mm' }}</p>
        <p><strong>Estado:</strong> {{ asesoria.estado }}</p>

        <!-- Cuando está aceptada -> mostrar botones -->
        @if (asesoria.estado === 'aceptada') {

          <div class="mt-3 space-x-3 flex">

            <a class="btn btn-success"
               target="_blank"
               [href]="getWhatsAppLink(asesoria)">
                <i class="fa-brands fa-whatsapp" style="color: #63E6BE;"></i>
              WhatsApp
            </a>



          </div>

        }
      </div>

    }
  } @else {
    <p class="text-gray-500">No hay historial todavía.</p>
  }


  @if (asesorSeleccionado()) {

    <div class="fixed inset-0 bg-black/60 flex justify-center items-center z-50">
      <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">

        <h3 class="text-lg font-bold mb-2">Responder Solicitud</h3>

        <p><strong>Usuario:</strong> {{ asesorSeleccionado()?.nombreUsuario }}</p>
        <p><strong>Teléfono:</strong> {{ asesorSeleccionado()?.telefono }}</p>
        <p><strong>Comentario:</strong> {{ asesorSeleccionado()?.mensaje }}</p>


        <textarea
          class="w-full border p-2 rounded mt-3"
          placeholder="Escribe tu mensaje..."
          [ngModel]="mensajeRespuesta()"
          (ngModelChange)="mensajeRespuesta.set($event)">
        </textarea>

        <div class="mt-4 flex justify-between">
          <button class="btn btn-success" (click)="enviarRespuesta('aceptada')">
            Aceptar
          </button>

          <button class="btn btn-error" (click)="enviarRespuesta('rechazada')">
            Rechazar
          </button>

          <button class="btn" (click)="asesorSeleccionado.set(null)">
            Cancelar
          </button>
        </div>

      </div>
    </div>

  }

</section>
